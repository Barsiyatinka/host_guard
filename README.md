# Домашнее задание к занятию   
**"`Репликация и масштабирование. Часть 2`"** - `Воскобойников Арсений Петрович`  
   
**Задание 1**  
``` 
Опишите основные преимущества использования масштабирования методами:  

активный master-сервер и пассивный репликационный slave-сервер;  
master-сервер и несколько slave-серверов;  
Дайте ответ в свободной форме.   
```
**Ответ**  

1. Активный master-сервер и пассивный репликационный slave-сервер  
Это:   
Один основной (master) сервер обрабатывает все запросы на запись и чтение, а вторичный (slave) сервер синхронно или асинхронно   получает копию данных, но не обслуживает пользователей до тех пор, пока master не выйдет из строя. 
   
Преимущества:  

Повышение отказоустойчивости: в случае сбоя master-сервера можно быстро переключиться на slave.  

Безопасное резервное копирование: можно снимать бэкапы со slave-сервера, не нагружая основной.  

Простота настройки и поддержки: такой подход проще в реализации, чем активная балансировка.  

Недостаток:  
В обычном режиме не используются вычислительные ресурсы slave-сервера — он "пассивный".  

2. Master-сервер и несколько slave-серверов  
Это:  
Один master-сервер обрабатывает все записи, а несколько slave-серверов синхронизируют данные и могут использоваться для чтения.  

Преимущества:  

Масштабируемость на чтение: можно распределить нагрузку на чтение по нескольким серверам, разгрузив master.  

Быстрое восстановление: если один slave выйдет из строя, его можно быстро заменить другим.  

Удобство при аналитике и отчётах: сложные SELECT-запросы можно направить на slave-серверы, не мешая основной системе.  

Резервное копирование без нагрузки: можно снимать резервные копии с любого из slave-серверов.  

Недостаток:  
Master остаётся узким местом для записи. Репликация асинхронная — данные на slave могут быть немного "отстающими".  

**Задание 2**  
```
Разработайте план для выполнения горизонтального и вертикального шаринга базы данных. База данных состоит из трёх таблиц:  

пользователи,   
книги,  
магазины (столбцы произвольно).  
Опишите принципы построения системы и их разграничение или разбивку между базами данных.  

Пришлите блоксхему, где и что будет располагаться. Опишите, в каких режимах будут работать сервера.  
```
**Ответ**  

1. Вертикальный шардинг  
- Разделение таблиц по разным базам данных/серверам по типу данных или функциональности.  

Разделение:  
DB_Users — содержит таблицу users  
DB_Books — содержит таблицу books  
DB_Shops — содержит таблицу shops  

Преимущества:  
Упрощается управление БД (каждая отвечает за свой набор данных).  

Повышается производительность: нагрузка по разным доменам распределена.  

2. Горизонтальный шардинг  
Деление одной таблицы на части по какому-то признаку (например, по региону, user_id, shop_id).  

Таблица users разбита на:  

users_eu (пользователи из Европы)  

users_asia  

users_usa  

Таблица books разбита по категориям книг:  

books_fiction, books_technical, books_children  

Таблица shops разбита по городам:  

shops_moscow, shops_ny, shops_tokyo  

Преимущества:  
Меньшие таблицы — быстрее запросы.  

Повышенная отказоустойчивость: один шард упал — остальные работают.  

Масштабируемость: легко добавить новый шард.  

3. Режимы работы серверов
Сервер	         Назначение	            Режим
db_users_eu	        пользователи из Европы	            master
db_users_asia	    пользователи из Азии	            master
db_books_fiction	книги жанра fiction	                master
db_shops_moscow	    магазины Москвы	                    master
analytics_replica	реплика всех shard'ов для аналитики	slave

Каждый мастер-шард обрабатывает только свой сегмент.

Отдельные реплики (slaves) подключаются к каждому мастер-шарду для отчётности, резервного копирования и аналитики.

Блок-схема:
```
                            ┌──────────────────────┐
                            │   Приложение (API)   │
                            └────────┬─────────────┘
                                     │
                    ┌────────────────┼────────────────┐
                    │                                │
        ┌───────────▼─────────────┐     ┌────────────▼────────────┐
        │  Шардинг пользователей  │     │     Вертикальный        │
        │   (горизонтальный)      │     │   шардинг: Книги + Магазины │
        └───────────┬─────────────┘     └────────────┬────────────┘
                    │                                │
        ┌───────────▼────────────┐        ┌──────────▼──────────┐
        │ users_shard_1 (регион RU)│        │    DB: Книги — core поля │
        ├─────────────────────────┤        └────────────────────┘
        │ users_shard_2 (регион EU)│        ┌──────────▼──────────┐
        └─────────────────────────┘        │    DB: Книги — текст │
                                           └──────────────────────┘
                                           ┌──────────▼──────────┐
                                           │    DB: Магазины     │
                                           └──────────────────────┘

```

