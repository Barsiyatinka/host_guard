# Домашнее задание к занятию   
**"`Резервное копирование баз данных`"** - `Воскобойников Арсений Петрович`  
   
**Задание 1. Резервное копирование**  
``` 
Кейс
Финансовая компания решила увеличить надёжность работы баз данных и их резервного копирования.

Необходимо описать, какие варианты резервного копирования подходят в случаях:

1.1. Необходимо восстанавливать данные в полном объёме за предыдущий день.

1.2. Необходимо восстанавливать данные за час до предполагаемой поломки.

1.3.* Возможен ли кейс, когда при поломке базы происходило моментальное переключение на работающую или починенную базу данных.

Приведите ответ в свободной форме.
```
**Ответ**  

1.1. Необходимо восстанавливать данные в полном объёме за предыдущий день Решение:  
Использовать полное ежедневное резервное копирование (Full Backup).  

Описание:

Ежедневно (например, в 00:00) выполняется полный бэкап всей базы данных.  

Бэкапы хранятся на выделенном сервере или в облачном хранилище.

Можно использовать pg_dump, mysqldump.

Преимущества:  

Простое восстановление всего состояния базы.  

Надёжность и проверенная стратегия.  

1.2. Необходимо восстанавливать данные за час до предполагаемой поломки Решение:  
Использовать инкрементальное копирование + журналы изменений (WAL, binlog).  

Описание:  

Делается один полный бэкап в сутки.  

В течение дня сохраняются журналы изменений (Write Ahead Log для PostgreSQL, Binary Log для MySQL).  

В случае сбоя восстанавливается полный бэкап, затем «доигрываются» изменения до нужной точки во времени.

Точность восстановления:

До минут или даже до секунд (в зависимости от конфигурации).

Преимущества:

Оптимальный баланс между частотой сохранения и объёмом хранилища.

Подходит для критически важных систем, где потеря данных даже за 1 час недопустима.


**Задание 2. PostgreSQL**  
```
2.1. С помощью официальной документации приведите пример команды резервирования данных и восстановления БД (pgdump/pgrestore).  

2.1.* Возможно ли автоматизировать этот процесс? Если да, то как?  

Приведите ответ в свободной форме.
```
**Ответ**  
2.1. Пример команды резервного копирования и восстановления PostgreSQL
Резервное копирование (с помощью pg_dump):  

pg_dump -U postgres -d my_database -F c -f /backup/my_database.backup
-U postgres — пользователь базы данных;  

-d my_database — имя базы данных, которую нужно сохранить;  

-F c — формат резервной копии (custom, можно также plain, tar, directory);  

-f /backup/my_database.backup — путь к файлу, в который будет сохранена копия.  

Восстановление базы данных (с помощью pg_restore):

pg_restore -U postgres -d my_database_restored -C -v /backup/my_database.backup
-U postgres — пользователь базы данных;

-d my_database_restored — имя БД, в которую будет восстановлена копия (можно создать заранее или использовать -C для автоматического создания);

-C — создать базу, если её ещё нет;

-v — подробный вывод (verbose);

/backup/my_database.backup — путь к резервной копии.

2.1. Возможна ли автоматизация?*
Да, процесс можно автоматизировать несколькими способами:

1. Скрипт на Bash + Cron
2. Использование специализированных инструментов:
- pgBackRest — мощный инструмент для создания резервных копий, инкрементальных копий, восстановления и репликации;

- Barman — решение от 2ndQuadrant, позволяет управлять резервным копированием и восстановлением нескольких серверов PostgreSQL;

- Wal-G — инструмент для резервного копирования с поддержкой Point-In-Time Recovery и облачных хранилищ (S3 и др.).

**Задание 3. MySQL**  
```
3.1. С помощью официальной документации приведите пример команды инкрементного резервного копирования базы данных MySQL.

3.1.* В каких случаях использование реплики будет давать преимущество по сравнению с обычным резервным копированием?

Приведите ответ в свободной форме.
```
**Ответ**  
Для инкрементного резервного копирования в MySQL часто используют Percona XtraBackup — это бесплатный инструмент, который поддерживает создание полных и инкрементных копий базы данных InnoDB.

**Полный бэкап** (создаётся один раз)
xtrabackup --backup --target-dir=/backups/full --datadir=/var/lib/mysql

**Инкрементный бэкап** (создаётся позже на основе полного)
xtrabackup --backup --target-dir=/backups/inc1 --incremental-basedir=/backups/full --datadir=/var/lib/mysql

**Восстановление:**
1.Применить redo логи к полному бэкапу:

xtrabackup --prepare --target-dir=/backups/full

2. Применить инкрементный бэкап:

xtrabackup --prepare --target-dir=/backups/full --incremental-dir=/backups/inc1
3. Восстановить базу данных:

xtrabackup --copy-back --target-dir=/backups/full

3.1. Когда использование реплики даёт преимущество перед обычным резервным копированием?*
Репликация — это процесс, при котором изменения из основной базы данных (мастера) автоматически передаются на реплику (slave/standby сервер). Это не то же самое, что резервное копирование, но может дополнять его или использоваться в критически важных системах.

Преимущества реплики над обычным бэкапом:
Минимальное время простоя.
При отказе главной базы можно быстро переключиться на реплику без необходимости восстановления из бэкапа (время RTO стремится к нулю).

Разгрузка основной базы.
Реплику можно использовать для аналитических запросов или для чтения, разгружая мастер-базу.

Моментальное переключение при сбое.
При настройке автоматического failover можно добиться бесперебойной работы сервиса.

Гибридный подход.
Репликация позволяет сохранять доступность данных, а резервное копирование — обеспечивает долгосрочное хранение и защиту от логических ошибок (удалений, порчи данных).


